<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hogwarts Run</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#0a0a1a;color:white;font-family:Arial;overflow:hidden}
canvas{display:block;margin:auto;background:#111}
.menu,.panel{
position:absolute;top:0;left:0;width:100%;height:100%;
display:flex;flex-direction:column;justify-content:center;align-items:center;
background:rgba(0,0,0,0.85)
}
.hidden{display:none}
button{
padding:12px 28px;margin:8px;font-size:18px;
border:none;border-radius:8px;
background:#6b4eff;color:white;cursor:pointer
}
#hud{
position:absolute;top:10px;left:10px;font-size:14px
}
.preview{
width:80px;height:120px;margin:10px;
border:2px solid white;display:flex;flex-direction:column;
align-items:center;justify-content:center
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="menu" class="menu">
<h1>üèÉ Hogwarts Run</h1>
<button onclick="startCountdown()">PLAY</button>
<button onclick="openSelect()">SELECT CHARACTER</button>
</div>

<div id="select" class="panel hidden">
<h2>Select Character</h2>

<div class="preview" id="charPreview"></div>

<select onchange="selectChar(this.value)">
<option>Harry</option>
<option>Hermione</option>
<option>Ron</option>
<option>Neville</option>
</select>

Dress <input type="color" onchange="chars[currentChar].dress=this.value;drawPreview()">
Face <input type="color" onchange="chars[currentChar].face=this.value;drawPreview()">

<button onclick="closePanels()">BACK</button>
</div>

<div id="hud" class="hidden">
Score: <span id="score">0</span><br>
Potions: <span id="coins">0</span>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=innerWidth;
canvas.height=innerHeight;

let running=false, countdown=0;
let score=0, coins=0;
let speed=8;
let voldemortDist=800; // FAR AWAY (FIXED)

const lanes=3;
const chars={
Harry:{dress:"#2e7d32",face:"#f5cfa0"},
Hermione:{dress:"#6a1b9a",face:"#f2c9ac"},
Ron:{dress:"#b71c1c",face:"#f7d7b5"},
Neville:{dress:"#f9a825",face:"#f3d0aa"}
};
let currentChar="Harry";

const player={lane:1,y:0,vy:0};
let obstacles=[],items=[];

document.addEventListener("keydown",e=>{
if(!running)return;
if(e.key==="ArrowLeft")player.lane=Math.max(0,player.lane-1);
if(e.key==="ArrowRight")player.lane=Math.min(lanes-1,player.lane+1);
if(e.key==="ArrowUp" && player.y===0)player.vy=16;
});

function startCountdown(){
menu.classList.add("hidden");
hud.classList.remove("hidden");
countdown=3;
const timer=setInterval(()=>{
if(countdown===0){
clearInterval(timer);
startGame();
}
countdown--;
},1000);
drawCountdown();
}

function drawCountdown(){
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.fillStyle="white";
ctx.font="60px Arial";
ctx.textAlign="center";
ctx.fillText(countdown>0?countdown:"RUN!",canvas.width/2,canvas.height/2);
if(countdown>=0)requestAnimationFrame(drawCountdown);
}

function startGame(){
running=true;
score=coins=0;
voldemortDist=800;
loop();
}

function loop(){
if(!running)return;
ctx.clearRect(0,0,canvas.width,canvas.height);

drawRoad();

player.vy-=1;
player.y=Math.max(0,player.y+player.vy);
if(player.y===0)player.vy=0;

if(Math.random()<0.02)obstacles.push({lane:randLane(),y:canvas.height});
if(Math.random()<0.03)items.push({lane:randLane(),y:canvas.height});

drawPlayer();
updateObjects();
drawVoldemort();

score++;
scoreEl.textContent=score;
coinsEl.textContent=coins;

requestAnimationFrame(loop);
}

function drawRoad(){
const w=canvas.width/lanes;
ctx.strokeStyle="#444";
for(let i=1;i<lanes;i++){
ctx.beginPath();
ctx.moveTo(i*w,0);
ctx.lineTo(i*w,canvas.height);
ctx.stroke();
}
}

function drawPlayer(){
const w=canvas.width/lanes;
const x=player.lane*w+w/2;
const y=canvas.height-120-player.y;

ctx.fillStyle=chars[currentChar].dress;
ctx.fillRect(x-20,y,40,60);
ctx.fillStyle=chars[currentChar].face;
ctx.beginPath();
ctx.arc(x,y-10,14,0,Math.PI*2);
ctx.fill();
}

function updateObjects(){
const w=canvas.width/lanes;
obstacles.forEach(o=>{
o.y-=speed;
ctx.fillStyle="crimson";
ctx.fillRect(o.lane*w+w/2-25,o.y,50,50);
if(o.y<canvas.height-150 && o.lane===player.lane){
voldemortDist-=40;
}
});
items.forEach(i=>{
i.y-=speed;
ctx.fillStyle="cyan";
ctx.beginPath();
ctx.arc(i.lane*w+w/2,i.y,12,0,Math.PI*2);
ctx.fill();
if(i.y<canvas.height-150 && i.lane===player.lane){
coins++;
}
});
}

function drawVoldemort(){
voldemortDist-=0.3; // slow chase
ctx.fillStyle="purple";
ctx.fillRect(canvas.width/2-30,canvas.height+voldemortDist,60,80);
if(voldemortDist<120)gameOver();
}

function gameOver(){
running=false;
alert("Voldemort caught you!\nScore: "+score);
location.reload();
}

function randLane(){return Math.floor(Math.random()*lanes)}

function openSelect(){
menu.classList.add("hidden");
select.classList.remove("hidden");
drawPreview();
}
function closePanels(){
select.classList.add("hidden");
menu.classList.remove("hidden");
}

function selectChar(c){currentChar=c;drawPreview()}

function drawPreview(){
const p=document.getElementById("charPreview");
p.innerHTML="";
const c=document.createElement("canvas");
c.width=60;c.height=100;
const x=c.getContext("2d");
x.fillStyle=chars[currentChar].dress;
x.fillRect(20,30,20,40);
x.fillStyle=chars[currentChar].face;
x.beginPath();x.arc(30,20,10,0,7);x.fill();
p.appendChild(c);
}
</script>
</body>
</html>
