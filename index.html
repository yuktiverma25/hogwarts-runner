<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hogwarts Run</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI}
body{background:#050512;color:#fff;overflow:hidden}
canvas{display:block;margin:auto}
.panel{
position:absolute;top:0;left:0;width:100%;height:100%;
display:flex;flex-direction:column;justify-content:center;align-items:center;
background:rgba(0,0,0,.85)
}
button{
padding:12px 30px;margin:8px;font-size:18px;
border:none;border-radius:8px;
background:#6b4eff;color:#fff;cursor:pointer
}
button:hover{background:#8a74ff}
.hidden{display:none}
#hud{
position:absolute;top:10px;left:10px;font-size:14px;
background:rgba(0,0,0,.4);padding:8px;border-radius:6px
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="menu" class="panel">
<h1>üèÉ Hogwarts Run</h1>
<button onclick="startGame()">PLAY</button>
<button onclick="openSelect()">SELECT CHARACTER</button>
<button onclick="toggleSound()">SOUND</button>
</div>

<div id="select" class="panel hidden">
<h2>Select Character</h2>
<select onchange="currentChar=this.value">
<option>Harry</option>
<option>Hermione</option>
<option>Ron</option>
<option>Neville</option>
</select><br>
Dress <input type="color" onchange="chars[currentChar].dress=this.value"><br>
Face <input type="color" onchange="chars[currentChar].face=this.value">
<button onclick="closePanels()">BACK</button>
</div>

<div id="hud" class="hidden">
Score: <span id="score">0</span><br>
Potions: <span id="coins">0</span><br>
Keys: <span id="keys">0</span><br>
Task: <span id="task">Collect 20 Potions</span>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
resize();window.onresize=resize;

let running=false,soundOn=true;
let score=0,coins=0,keys=0;
let speed=8,gravity=1;
let broom=0,shield=0,magnet=0;
let voldemortDist=300;
let taskTarget=20;
let highScore=localStorage.getItem("hogwartsScore")||0;

const lanes=3;
const chars={
Harry:{dress:"#2e7d32",face:"#f5cfa0",jump:16},
Hermione:{dress:"#6a1b9a",face:"#f2c9ac",jump:17},
Ron:{dress:"#b71c1c",face:"#f7d7b5",jump:15},
Neville:{dress:"#f9a825",face:"#f3d0aa",jump:14}
};
let currentChar="Harry";

const player={lane:1,y:0,vy:0};
let obstacles=[],items=[];

document.addEventListener("keydown",e=>{
if(!running)return;
if(e.key==="ArrowLeft")player.lane=Math.max(0,player.lane-1);
if(e.key==="ArrowRight")player.lane=Math.min(lanes-1,player.lane+1);
if(e.key==="ArrowUp"&&player.y===0)player.vy=chars[currentChar].jump;
if(e.key==="p")running=!running;
});
canvas.addEventListener("dblclick",()=>broom=250);

// Mobile swipe
let touchX=0;
canvas.addEventListener("touchstart",e=>touchX=e.touches[0].clientX);
canvas.addEventListener("touchend",e=>{
let dx=e.changedTouches[0].clientX-touchX;
if(dx>50)player.lane=Math.min(lanes-1,player.lane+1);
if(dx<-50)player.lane=Math.max(0,player.lane-1);
});

function resize(){
canvas.width=innerWidth;
canvas.height=innerHeight;
}

function startGame(){
menu.classList.add("hidden");
hud.classList.remove("hidden");
running=true;
score=coins=keys=0;
obstacles=[];items=[];
player.lane=1;player.y=0;player.vy=0;
voldemortDist=300;
loop();
if(soundOn)music();
}

function loop(){
if(!running)return;
ctx.clearRect(0,0,canvas.width,canvas.height);

// Background
ctx.fillStyle="rgb(20,20,40)";
ctx.fillRect(0,0,canvas.width,canvas.height);

// Physics
player.vy-=gravity;
player.y=Math.max(0,player.y+player.vy);
if(player.y===0)player.vy=0;

// Spawn
if(Math.random()<0.025)obstacles.push({lane:randLane(),y:canvas.height});
if(Math.random()<0.03)items.push({
lane:randLane(),y:canvas.height,
type:Math.random()<0.7?"potion":"box"
});

drawPlayer();
updateObstacles();
updateItems();
drawVoldemort();

score++;
speed+=0.0005;

updateHUD();
requestAnimationFrame(loop);
}

function randLane(){return Math.floor(Math.random()*lanes)}

function drawPlayer(){
const w=canvas.width/lanes;
const x=player.lane*w+w/2;
const y=canvas.height-130-player.y;

ctx.fillStyle=chars[currentChar].dress;
ctx.fillRect(x-20,y,40,60);
ctx.fillStyle=chars[currentChar].face;
ctx.beginPath();ctx.arc(x,y-10,14,0,7);ctx.fill();

if(broom>0){
ctx.strokeStyle="gold";
ctx.lineWidth=3;
ctx.beginPath();
ctx.moveTo(x-35,y+30);ctx.lineTo(x+35,y+30);
ctx.stroke();
broom--;
}
}

function updateObstacles(){
const w=canvas.width/lanes;
obstacles.forEach(o=>{
o.y-=speed;
ctx.fillStyle="crimson";
ctx.fillRect(o.lane*w+w/2-25,o.y,50,50);

if(o.y<canvas.height-150&&o.y>canvas.height-210&&o.lane===player.lane){
if(shield>0)shield--;
else voldemortDist-=25;
}
});
}

function updateItems(){
const w=canvas.width/lanes;
items.forEach(i=>{
i.y-=speed;
ctx.fillStyle=i.type==="potion"?"cyan":"gold";
ctx.beginPath();
ctx.arc(i.lane*w+w/2,i.y,14,0,7);
ctx.fill();

if(i.y<canvas.height-150&&i.y>canvas.height-210&&i.lane===player.lane){
if(i.type==="potion"){
coins++;
if(coins>=taskTarget){
keys++;
taskTarget+=10;
}
}else activatePower();
}
});
}

function activatePower(){
let r=Math.random();
if(r<0.25)broom=300;
else if(r<0.5)shield=200;
else if(r<0.75)magnet=200;
else speed+=2;
}

function drawVoldemort(){
voldemortDist+=0.3;
ctx.fillStyle="purple";
ctx.fillRect(canvas.width/2-35,canvas.height+voldemortDist,70,90);
if(voldemortDist>80)gameOver();
}

function updateHUD(){
scoreEl.textContent=score;
coinsEl.textContent=coins;
keysEl.textContent=keys;
taskEl.textContent="Collect "+taskTarget+" Potions";
}

function gameOver(){
running=false;
if(score>highScore){
localStorage.setItem("hogwartsScore",score);
highScore=score;
}
alert("Voldemort caught you!\nScore: "+score+"\nHigh Score: "+highScore);
location.reload();
}

function openSelect(){
menu.classList.add("hidden");
select.classList.remove("hidden");
}
function closePanels(){
select.classList.add("hidden");
menu.classList.remove("hidden");
}
function toggleSound(){soundOn=!soundOn}

function music(){
const a=new AudioContext();
const o=a.createOscillator();
o.type="sine";
o.frequency.setValueAtTime(392,a.currentTime);
o.frequency.exponentialRampToValueAtTime(784,a.currentTime+1.5);
o.connect(a.destination);
o.start();
o.stop(a.currentTime+1.5);
}
</script>
</body>
</html>
