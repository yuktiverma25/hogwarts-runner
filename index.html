<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hogwarts Run HD</title>
    <style>
        :root { --gold: #d4af37; --maroon: #740001; --bg: #050505; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Segoe UI', sans-serif; }
        
        /* High-End UI */
        #ui-layer { position: absolute; width: 100%; height: 100%; z-index: 100; display: flex; flex-direction: column; align-items: center; justify-content: center; background: radial-gradient(circle, rgba(44,30,22,0.9) 0%, rgba(0,0,0,0.95) 100%); }
        .hidden { display: none !important; }
        
        .menu-card { background: rgba(0,0,0,0.8); padding: 40px; border: 3px solid var(--gold); border-radius: 20px; text-align: center; box-shadow: 0 0 30px var(--maroon); }
        .btn { background: var(--maroon); color: var(--gold); border: 2px solid var(--gold); padding: 15px 40px; margin: 10px; cursor: pointer; font-size: 22px; font-weight: bold; border-radius: 50px; width: 280px; transition: 0.3s; text-transform: uppercase; }
        .btn:hover { background: var(--gold); color: var(--maroon); transform: scale(1.05); }

        #hud { position: absolute; top: 20px; left: 20px; color: var(--gold); font-size: 24px; z-index: 50; text-shadow: 2px 2px 4px #000; font-weight: bold; pointer-events: none; }
        canvas { display: block; filter: saturate(1.2) contrast(1.1); }
        
        .config-row { display: flex; justify-content: space-between; align-items: center; width: 100%; margin: 15px 0; font-size: 18px; color: #fff; }
        input[type="color"] { width: 50px; height: 30px; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <div id="hud" class="hidden">
        SCORE: <span id="scoreVal">0</span> | POTIONS: <span id="potionVal">0</span> | KEYS: <span id="keyVal">0</span>
    </div>

    <div id="menu-screen" class="ui-layer">
        <div class="menu-card">
            <h1 style="color:var(--gold); font-size: 50px; margin: 0 0 20px 0;">âš¡ HOGWARTS RUN</h1>
            <button class="btn" onclick="startGame()">Start Duel</button>
            <button class="btn" onclick="showScreen('custom-screen')">Select Hero</button>
            <button class="btn" onclick="toggleAudio()">Music: <span id="music-status">OFF</span></button>
        </div>
    </div>

    <div id="custom-screen" class="hidden" style="position:absolute; width:100%; height:100%; z-index:101; display:flex; align-items:center; justify-content:center; background:rgba(0,0,0,0.9);">
        <div class="menu-card">
            <h2 style="color:var(--gold)">CHARACTER EDITOR</h2>
            <div class="config-row">
                <label>HERO:</label>
                <select id="heroSelect" style="padding:5px;"><option>Harry</option><option>Hermione</option><option>Ron</option><option>Neville</option></select>
            </div>
            <div class="config-row"><label>ROBE COLOR:</label> <input type="color" id="robeColor" value="#740001"></div>
            <div class="config-row"><label>SKIN COLOR:</label> <input type="color" id="skinColor" value="#ffdbac"></div>
            <button class="btn" onclick="showScreen('menu-screen')">SAVE MAGIC</button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameActive = false, score = 0, potions = 0, keys = 0;
        let lane = 1, speed = 7, broomActive = false;
        let obstacles = [], items = [], frame = 0;

        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();

        function showScreen(id) {
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('custom-screen').classList.add('hidden');
            document.getElementById(id).classList.remove('hidden');
        }

        // Controls
        window.addEventListener('keydown', (e) => {
            if(!gameActive) return;
            if(e.key === "ArrowLeft" && lane > 0) lane--;
            if(e.key === "ArrowRight" && lane < 2) lane++;
        });

        window.addEventListener('dblclick', () => {
            if(potions >= 5 && !broomActive) {
                broomActive = true; potions -= 5;
                setTimeout(() => broomActive = false, 6000);
            }
        });

        function startGame() {
            showScreen('hidden');
            document.getElementById('hud').classList.remove('hidden');
            gameActive = true; score = 0; potions = 0; keys = 0; speed = 7;
            obstacles = []; items = [];
            requestAnimationFrame(update);
        }

        function update() {
            if(!gameActive) return;
            ctx.fillStyle = "#0a0a0a";
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            drawTracks();
            handleLogic();
            drawHero();
            drawVoldemort();
            
            score++;
            document.getElementById('scoreVal').innerText = score;
            document.getElementById('potionVal').innerText = potions;
            document.getElementById('keyVal').innerText = keys;
            requestAnimationFrame(update);
        }

        function drawTracks() {
            ctx.strokeStyle = "rgba(212,175,55,0.2)";
            ctx.lineWidth = 4;
            for(let i=1; i<3; i++) {
                ctx.beginPath();
                ctx.moveTo(i * (canvas.width/3), 0);
                ctx.lineTo(i * (canvas.width/3), canvas.height);
                ctx.stroke();
            }
        }

        function handleLogic() {
            frame++;
            if(frame % 60 === 0) obstacles.push({x: Math.floor(Math.random()*3), y: -100});
            if(frame % 45 === 0) items.push({x: Math.floor(Math.random()*3), y: -100, type: Math.random() > 0.2 ? 'P' : 'K'});

            // Move Obstacles (HD Dementors)
            obstacles.forEach((obs, i) => {
                obs.y += speed;
                const ox = (obs.x * (canvas.width/3)) + (canvas.width/6);
                ctx.fillStyle = "rgba(50,50,50,0.8)";
                ctx.beginPath(); ctx.ellipse(ox, obs.y, 30, 50, 0, 0, Math.PI*2); ctx.fill();
                
                if(!broomActive && obs.y > canvas.height-140 && obs.y < canvas.height-60 && obs.x === lane) {
                    gameActive = false;
                    alert("STUPEFIED! Final Score: " + score);
                    location.reload();
                }
            });

            // Move Items (HD Glow)
            items.forEach((it, i) => {
                it.y += speed;
                const ix = (it.x * (canvas.width/3)) + (canvas.width/6);
                ctx.shadowBlur = 15;
                ctx.shadowColor = it.type === 'P' ? "#0f0" : "#ff0";
                ctx.fillStyle = it.type === 'P' ? "#0f0" : "#ff0";
                ctx.beginPath(); ctx.arc(ix, it.y, 15, 0, 7); ctx.fill();
                ctx.shadowBlur = 0;

                if(it.y > canvas.height-140 && it.y < canvas.height-60 && it.x === lane) {
                    if(it.type === 'P') potions++; else keys++;
                    items.splice(i, 1);
                }
            });
            speed += 0.002;
        }

        function drawHero() {
            const hX = (lane * (canvas.width/3)) + (canvas.width/6);
            const hY = canvas.height - 100;
            
            // HD Hero
            ctx.fillStyle = document.getElementById('robeColor').value;
            ctx.fillRect(hX - 25, hY, 50, 70);
            ctx.fillStyle = document.getElementById('skinColor').value;
            ctx.beginPath(); ctx.arc(hX, hY-20, 20, 0, 7); ctx.fill();
            
            if(broomActive) {
                ctx.strokeStyle = "#ffd700"; ctx.lineWidth = 8;
                ctx.beginPath(); ctx.moveTo(hX-50, hY+40); ctx.lineTo(hX+50, hY+40); ctx.stroke();
            }
        }

        function drawVoldemort() {
            ctx.fillStyle = "rgba(255,0,0,0.15)";
            ctx.font = "bold 30px Arial";
            ctx.fillText("VOLDEMORT IS CHASING...", canvas.width/2 - 180, 100 + Math.sin(frame/10)*10);
        }

        let audio;
        function toggleAudio() {
            if(!audio) {
                audio = new AudioContext();
                const osc = audio.createOscillator();
                const g = audio.createGain();
                osc.type = 'sawtooth'; g.gain.value = 0.02;
                osc.connect(g); g.connect(audio.destination);
                osc.start();
                document.getElementById('music-status').innerText = "ON";
            }
        }
    </script>
</body>
</html>
